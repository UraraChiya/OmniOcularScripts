<!--Author: UraraChiya-->
<!--Date: 2025/12/24-->
<!--Version: V33a-->
<!--Requie: OmniOcular.xml-->
<oo>
    <init>
        var LUMENCOLORFORMAT = {
            BLACK: BLACK,
            RED: DRED,
            GREEN: DGREEN,
            BROWN: GOLD,
            BLUE: DBLUE,
            PURPLE: DPURPLE,
            CYAN: DAQUA,
            LIGHTGRAY: GRAY,
            GRAY: DGRAY,
            PINK: RED,
            LIME: GREEN,
            YELLOW: YELLOW,
            LIGHTBLUE: AQUA,
            MAGENTA: LPURPLE,
            ORANGE: GOLD,
            WHITE: WHITE
        };
        var LUMENIDTOCOLOR = {
            0: 'BLACK',
            1: 'RED',
            2: 'GREEN',
            3: 'BROWN',
            4: 'BLUE',
            5: 'PURPLE',
            6: 'CYAN',
            7: 'LIGHTGRAY',
            8: 'GRAY',
            9: 'PINK',
            10: 'LIME',
            11: 'YELLOW',
            12: 'LIGHTBLUE',
            13: 'MAGENTA',
            14: 'ORANGE',
            15: 'WHITE'
        };
        var LUMENIDTOFORMAT = {
            0: BLACK,
            1: DRED,
            2: DGREEN,
            3: GOLD,
            4: DBLUE,
            5: DPURPLE,
            6: DAQUA,
            7: GRAY,
            8: DGRAY,
            9: LPURPLE,
            10: GREEN,
            11: YELLOW,
            12: AQUA,
            13: LPURPLE,
            14: GOLD,
            15: WHITE
        };
        var LUMENCOLOR = [
            'BLACK',
            'RED',
            'GREEN',
            'BROWN',
            'BLUE',
            'PURPLE',
            'CYAN',
            'LIGHTGRAY',
            'GRAY',
            'PINK',
            'LIME',
            'YELLOW',
            'LIGHTBLUE',
            'MAGENTA',
            'ORANGE',
            'WHITE'
        ];
        var LUMENCOLORTOID = {
            BLACK: 0,
            RED: 1,
            GREEN: 2,
            BROWN: 3,
            BLUE: 4,
            PURPLE: 5,
            CYAN: 6,
            LIGHTGRAY: 7,
            GRAY: 8,
            PINK: 9,
            LIME: 10,
            YELLOW: 11,
            LIGHTBLUE: 12,
            MAGENTA: 13,
            ORANGE: 14,
            WHITE: 15
        };
    </init>
    <init>
        var PITCH_TO_CRYSTALS = {
            36: [{ id: 0, name: 'Black', idx: 0 }],
            38: [{ id: 3, name: 'Brown', idx: 0 }],
            40: [
                { id: 0, name: 'Black', idx: 1 },
                { id: 4, name: 'Blue', idx: 0 },
                { id: 14, name: 'Orange', idx: 0 }
            ],
            41: [{ id: 2, name: 'Green', idx: 0 }],
            42: [{ id: 3, name: 'Brown', idx: 1 }],
            43: [
                { id: 0, name: 'Black', idx: 2 },
                { id: 1, name: 'Red', idx: 0 },
                { id: 14, name: 'Orange', idx: 1 }
            ],
            44: [
                { id: 2, name: 'Green', idx: 1 },
                { id: 4, name: 'Blue', idx: 1 }
            ],
            45: [
                { id: 3, name: 'Brown', idx: 2 },
                { id: 5, name: 'Purple', idx: 0 },
                { id: 6, name: 'Cyan', idx: 0 }
            ],
            47: [
                { id: 1, name: 'Red', idx: 1 },
                { id: 4, name: 'Blue', idx: 2 },
                { id: 13, name: 'Magenta', idx: 0 },
                { id: 14, name: 'Orange', idx: 2 }
            ],
            48: [
                { id: 0, name: 'Black', idx: 3 },
                { id: 2, name: 'Green', idx: 2 },
                { id: 6, name: 'Cyan', idx: 1 },
                { id: 8, name: 'Gray', idx: 0 }
            ],
            49: [{ id: 5, name: 'Purple', idx: 1 }],
            50: [
                { id: 1, name: 'Red', idx: 2 },
                { id: 3, name: 'Brown', idx: 3 },
                { id: 7, name: 'LightGray', idx: 0 }
            ],
            51: [
                { id: 8, name: 'Gray', idx: 1 },
                { id: 13, name: 'Magenta', idx: 1 }
            ],
            52: [
                { id: 4, name: 'Blue', idx: 3 },
                { id: 5, name: 'Purple', idx: 2 },
                { id: 6, name: 'Cyan', idx: 2 },
                { id: 10, name: 'Lime', idx: 0 },
                { id: 14, name: 'Orange', idx: 3 }
            ],
            53: [
                { id: 2, name: 'Green', idx: 3 },
                { id: 7, name: 'LightGray', idx: 1 },
                { id: 9, name: 'Pink', idx: 0 }
            ],
            54: [{ id: 13, name: 'Magenta', idx: 2 }],
            55: [
                { id: 1, name: 'Red', idx: 3 },
                { id: 8, name: 'Gray', idx: 2 },
                { id: 11, name: 'Yellow', idx: 0 }
            ],
            56: [{ id: 10, name: 'Lime', idx: 1 }],
            57: [
                { id: 5, name: 'Purple', idx: 3 },
                { id: 6, name: 'Cyan', idx: 3 },
                { id: 7, name: 'LightGray', idx: 2 },
                { id: 9, name: 'Pink', idx: 1 },
                { id: 12, name: 'LightBlue', idx: 0 }
            ],
            59: [
                { id: 10, name: 'Lime', idx: 2 },
                { id: 11, name: 'Yellow', idx: 1 },
                { id: 13, name: 'Magenta', idx: 3 }
            ],
            60: [
                { id: 8, name: 'Gray', idx: 3 },
                { id: 9, name: 'Pink', idx: 2 },
                { id: 15, name: 'White', idx: 0 }
            ],
            61: [{ id: 12, name: 'LightBlue', idx: 1 }],
            62: [
                { id: 7, name: 'LightGray', idx: 3 },
                { id: 11, name: 'Yellow', idx: 2 }
            ],
            64: [
                { id: 10, name: 'Lime', idx: 3 },
                { id: 12, name: 'LightBlue', idx: 2 },
                { id: 15, name: 'White', idx: 1 }
            ],
            65: [{ id: 9, name: 'Pink', idx: 3 }],
            67: [
                { id: 11, name: 'Yellow', idx: 3 },
                { id: 15, name: 'White', idx: 2 }
            ],
            69: [{ id: 12, name: 'LightBlue', idx: 3 }],
            72: [{ id: 15, name: 'White', idx: 3 }]
        };
    </init>
    <!-- CC 共有内容 -->
    <tileentity id="CC.*">
        <line displayname="hud.msg.ChromatiCraft.Place">
            var result = '';
            if (nbt.place) {
                result += nbt.place;
            }
            if (nbt.placeUUID && nbt.place != uuid2name(nbt.placeUUID)) {
                result +=
                    ' ' +
                    uuid2name(nbt.placeUUID) +
                    ' ' +
                    translate('hud.msg.ChromatiCraft.Place.NotSamePlayer');
            }
            if (result) return result;
        </line>
        <line displayname="hud.msg.common.Owner">
            if (nbt.owners[0]) return uuid2name(nbt.owners[0]);
        </line>
        <line displayname="hud.msg.ChromatiCraft.Struct">
            if (nbt.struct == 1) {
                return GREEN + translate('hud.msg.ChromatiCraft.Struct.Formed');
            } else if (nbt.struct == 0) {
                return RED + translate('hud.msg.ChromatiCraft.Struct.Unformed');
            }
        </line>
        <line displayname="hud.msg.ChromatiCraft.Tier">
            return nbt.tier;
        </line>
        <line displayname="hud.msg.ChromatiCraft.CraftRemain">
            if (nbt.craft) {
                return nbt.craft + ' ' + translate('hud.msg.common.Ticks');
            }
        </line>
        <line displayname="hud.msg.ChromatiCraft.Energy">
            if (nbt.energy) {
                switch (typeof nbt.energy) {
                    case 'object':
                        var results = ['\\n'];
                        var lumens = [];
                        for (var i = 0; i < LUMENCOLOR.length; i++) {
                            var color = LUMENCOLOR[i];
                            if (nbt.energy[color]) {
                                lumens.push(
                                    LUMENIDTOFORMAT[i] +
                                        padSpaces(i, 2) +
                                        ': ' +
                                        formatAlignedSI(nbt.energy[color])
                                );
                            }
                        }

                        for (var i = 0; i < lumens.length; i += 4) {
                            var row = [];
                            for (var j = 0; j < 4; j++) {
                                if (i + j < lumens.length) {
                                    row.push(lumens[i + j]);
                                }
                            }
                            results.push(row.join(TAB));
                        }

                        if (lumens.length > 0) return results.join('\\n  ');
                        break;
                    case 'number':
                        if (nbt.color != undefined) {
                            return LUMENCOLORFORMAT[LUMENCOLOR[nbt.color]] + formatAlignedSI(nbt.energy);
                        }
                        return formatAlignedSI(nbt.energy);
                        break;
                    default:
                        break;
                }
            }
        </line>
    </tileentity>
    <!-- 铸件桌 -->
    <tileentity id="CCchroma.table">
        <line displayname="XP">
            return numberWithCommas(nbt.xp);
        </line>
    </tileentity>
    <!-- 能量塔 -->
    <tileentity id="CCchroma.pylon">
        <line displayname="hud.msg.ChromatiCraft.Struct">
            if (nbt.multi) {
                return GREEN + translate('hud.msg.ChromatiCraft.Struct.Formed');
            } else {
                return RED + translate('hud.msg.ChromatiCraft.Struct.Unformed');
            }
        </line>
    </tileentity>
    <!-- 灵气中继器 -->
    <tileentity id="CCchroma.repeater">
        <line displayname="hud.msg.ChromatiCraft.Repeater.Depth">
            return nbt.depth;
        </line>
        <!--<line displayname="hud.msg.ChromatiCraft.Repeater.States">
    return nbt.states;
</line>
        <line displayname="hud.msg.ChromatiCraft.Repeater.Meta">
            return nbt.meta;
        </line>-->
    </tileentity>
    <!-- 复合灵气中继器 -->
    <tileentity id="CCchroma.compound">
        <line displayname="hud.msg.ChromatiCraft.Repeater.Depth">
            var results = ['\\n'];
            var depths = [];
            for (var i = 0; i < 16; i++) {
                var depth = nbt['depth_' + i] || -1;
                depths.push(LUMENIDTOFORMAT[i] + padSpaces(i, 2) + ': ' + depth);
            }
            for (var i = 0; i < depths.length; i += 4) {
                var row = [];
                for (var j = 0; j < 4; j++) {
                    if (i + j < depths.length) {
                        row.push(depths[i + j]);
                    }
                }
                results.push(row.join(TAB));
            }

            if (depths.length > 0) return results.join('\\n  ');
            return;
        </line>
        <!--
        <line displayname="hud.msg.ChromatiCraft.Repeater.States">
            return nbt.states;
        </line>
        <line displayname="hud.msg.ChromatiCraft.Repeater.Meta">
            return nbt.meta;
        </line>-->
    </tileentity>
    <!-- 仪式桌 -->
    <tileentity id="CCchroma.ritual">
        <line displayname="hud.msg.ChromatiCraft.Ritual.Ability">
            return nbt.ability;
        </line>
    </tileentity>
    <!-- 嬗变火 -->
    <tileentity id="CCchroma.glowfire">
        <line displayname="hud.msg.ChromatiCraft.Glowfire.Target">
            if (nbt.Items[0]) return name(nbt.Items[0]);
        </line>
    </tileentity>
    <!-- 矿工 -->
    <tileentity id="CCchroma.miner">
        <line displayname="hud.msg.ChromatiCraft.Miner.Dropped">
            return nbt.dropped ? RED + 'Yes' : GREEN + 'No';
        </line>
        <line displayname="hud.msg.ChromatiCraft.Miner.Fortune">
            return nbt.fortune;
        </line>
        <line displayname="hud.msg.ChromatiCraft.Miner.SilkTouch">
            return nbt.silk;
        </line>
        <line displayname="hud.msg.ChromatiCraft.Miner.Dig">
            return nbt.dig ? 'YES' : 'No';
        </line>
    </tileentity>
    <!-- 传送门裂缝 -->
    <tileentity id="CCTileEntityCrystalPortal">
        <line displayname="hud.msg.ChromatiCraft.CrystalPortal.Charge">
            if (nbt.built) return nbt.charge;
        </line>
        <line displayname="hud.msg.ChromatiCraft.CrystalPortal.Tuning">
            if (nbt.built) return nbt.tuning;
        </line>
    </tileentity>
    <!-- 环境流明分配核心 -->
    <tileentity id="CCchroma.wireless">
        <line displayname="hud.msg.ChromatiCraft.Wireless.Broadcast">
            if (nbt.broadcast2) {
                return translate('hud.msg.ChromatiCraft.Wireless.Broadcast.2');
            }
            if (nbt.broadcast) {
                return translate('hud.msg.ChromatiCraft.Wireless.Broadcast.l');
            }
        </line>
    </tileentity>
    <!-- Puzzle -->
    <!-- 水晶音乐存储 -->
    <tileentity id="CCTileMusicMemory">
        <line displayname="hud.msg.ChromatiCraft.Puzzle.Solution">
            if (nbt.keys && nbt.keys.length > 0) {
                var results = ['\\n'];
                /* 对应和弦索引 0, 1, 2, 3 的位置箭头 */
                var arrows = ['↖', '↗', '↘', '↙'];

                for (var i = 0; i < nbt.keys.length; i++) {
                    var key = nbt.keys[i];
                    /* 调用之前定义的解题函数 */
                    var solutions = PITCH_TO_CRYSTALS[key];

                    if (solutions.length > 0) {
                        /* 取第一个可能的解 (通常这就足够了) */
                        var res = solutions[0];

                        /* 获取颜色格式代码 (例如 DRED, DPURPLE 等) */
                        var colorFmt = LUMENIDTOFORMAT[res.id];

                        /* 格式化输出: 颜色代码 + 颜色名 + 方向箭头 */
                        /* 例如: "Purple ↖" (带颜色) */
                        results.push(
                            i +
                                TAB +
                                colorFmt +
                                LUMENIDTOCOLOR[res.id] +
                                ' ' +
                                GRAY +
                                res.id +
                                TAB +
                                colorFmt +
                                arrows[res.idx]
                        );
                    } else {
                        /* 如果找不到对应的解，显示白色未知 */
                        results.push(WHITE + 'Unknown (' + key + ')');
                    }
                }

                /* 在开头加一个换行，确保护符显示在标签下方，并用换行符连接所有步骤 */
                return results.join('\\n  ');
            }
        </line>
    </tileentity>
    <!-- 反射迷宫 -->
    <tileentity id="CCTileEntityStructureDataStorage">
        <line displayname="hud.msg.ChromatiCraft.Puzzle.Solution">
            /* ─ │ ╱ ╲ ◢ ◣ ◤ ◥ ▲ ▶ ▼ ◀ ▀ ▄ ▌ ▐ */
            switch (nbt.extra.level) {
                case 'mirrortut' /* 1 */:
                    return ['\\n', '⬜⬜⬜', '⬜ ╲ ◥', '⬜⬜⬜'].join('\\n' + WHITE);
                    break;
                case 'mirrors2' /* 2 */:
                    return [
                        '\\n',
                        '⬜ ◤⬜ ◥⬜⬜',
                        '⬜⬜ ◤⬜ ◥⬜',
                        ' ◣⬜ ╲ ╲⬜ ◥',
                        '⬜⬜⬜⬜⬜⬜',
                        ' ◤ ╱⬜ ╱⬜ ◢',
                        '⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                    break;
                case 'refractortut' /* 3 */:
                    return [
                        '\\n',
                        '⬜ ◤ ▶⬜⬜⬜',
                        '⬜ ╲ ◥ │⬜⬜',
                        '⬜⬜⬜⬜⬜⬜',
                        '⬜ │ ◤⬜⬜⬜',
                        '⬜⬜⬜⬜⬜ ▐',
                        ' ▲⬜⬜ ▄⬜⬜',
                        '⬜⬜⬜⬜ ▐⬜',
                        '⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                    break;
                case 'splittertut' /* 4 */:
                    return [
                        '\\n',
                        '⬜⬜ ◥⬜⬜ ◤⬜',
                        ' ◤⬜⬜⬜ ╲⬜ ◥',
                        '⬜⬜ ◤⬜⬜ ▼⬜',
                        ' ◤⬜⬜⬜ │⬜ ▼',
                        '⬜⬜⬜⬜⬜⬜⬜',
                        ' ▌⬜⬜⬜ ▲⬜ ▐',
                        '⬜⬜⬜⬜ ▼⬜⬜',
                        '⬜⬜ ▶⬜ ▲⬜⬜',
                        '⬜⬜⬜ ▐⬜⬜⬜',
                        '⬜⬜⬜⬜ ▼⬜⬜',
                        '⬜ ▌⬜⬜⬜⬜⬜',
                        '⬜⬜ ▄⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                case 'filtertut' /* 5 */:
                    return [
                        '\\n',
                        '⬜⬜⬜ ▀⬜⬜⬜',
                        '⬜ ▀⬜⬜⬜⬜⬜',
                        ' ▌ ▲⬜⬜⬜⬜⬜',
                        '⬜⬜ ◥⬜⬜ ▶ ▐',
                        '⬜⬜⬜⬜⬜⬜ ◢',
                        ' ▲ ◤⬜⬜ ▲⬜ │',
                        '⬜ ▌⬜⬜⬜ ◣⬜',
                        '⬜⬜ ◤⬜ ◢⬜⬜',
                        ' ◣⬜⬜⬜⬜⬜⬜',
                        '⬜⬜ ◥⬜⬜ ▶⬜',
                        '⬜ ▶⬜⬜ ─⬜ ▼',
                        '⬜⬜ ▄⬜⬜ ▄⬜'
                    ].join('\\n' + WHITE);
                case 'polartut' /* 6 */:
                    return [
                        '\\n',
                        ' ◤⬜ ▶ ◥⬜',
                        '⬜ ▀⬜⬜⬜',
                        ' │⬜⬜ ◢⬜',
                        '⬜⬜⬜ ╲⬜',
                        ' ◤⬜ ◢⬜ ▐',
                        '⬜⬜ ▲⬜⬜',
                        '⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                    break;
                case 'polar2' /* 7 */:
                    return [
                        '\\n',
                        '⬜⬜ ▀⬜⬜ ▀⬜',
                        ' ◤ ─ ▶ ─⬜⬜ ▐',
                        '⬜⬜ ╱⬜⬜ ▄⬜',
                        ' ◣⬜⬜⬜⬜ ▐⬜',
                        '⬜⬜⬜⬜ │⬜⬜',
                        '⬜⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                case 'oneway' /* 8 */:
                    return [
                        '\\n',
                        '⬜ ▀⬜⬜⬜⬜',
                        '⬜⬜⬜⬜ ▀⬜',
                        ' ▌⬜ ◢ ▶⬜ ▐',
                        '⬜ ◤ ◤⬜⬜ ▐',
                        '⬜⬜ ▲⬜⬜⬜',
                        '⬜⬜⬜⬜⬜ ◥',
                        '⬜⬜ ◥⬜⬜ ◢',
                        '⬜ ◥⬜ ◢⬜⬜',
                        '⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                case 'prismtut1' /* 9 */:
                    return [
                        '\\n',
                        '⬜⬜⬜⬜⬜⬜⬜',
                        '⬜ │⬜⬜ ▀⬜⬜',
                        '⬜ ◤ ▲⬜ ◥⬜⬜',
                        '⬜⬜⬜⬜⬜⬜ ▐',
                        '⬜⬜ │⬜⬜⬜⬜',
                        '⬜⬜⬜⬜⬜⬜⬜',
                        ' ▌⬜⬜⬜⬜⬜ ▐',
                        '⬜ ◀ ▲⬜ ◣⬜⬜',
                        '⬜⬜⬜⬜⬜⬜⬜',
                        '⬜⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                case 'prismtut2' /* 10 */:
                    return [
                        '\\n',
                        '⬜⬜⬜ ▀⬜⬜⬜⬜⬜⬜',
                        '⬜⬜⬜⬜⬜ ▀⬜⬜⬜⬜',
                        ' ◤⬜ ◥⬜⬜⬜⬜⬜⬜⬜',
                        '⬜ ▌⬜ ◀⬜ ◤⬜⬜⬜⬜',
                        '⬜⬜⬜ ◣⬜ ◥ ◢⬜⬜⬜',
                        ' ◣⬜⬜⬜⬜ ╱⬜ ◥⬜⬜',
                        '⬜⬜⬜⬜ ◤⬜ ▼⬜⬜⬜',
                        '⬜⬜⬜⬜⬜ ◣ ╱ ◢⬜⬜',
                        '⬜⬜⬜⬜⬜⬜⬜⬜ ◤ ◥',
                        '⬜⬜ ◣⬜ ╲⬜⬜⬜⬜ ◢',
                        '⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                case 'prism3' /* 11 */:
                    return [
                        '\\n',
                        '⬜⬜⬜⬜ ◤⬜ ◥⬜⬜⬜⬜',
                        '⬜⬜⬜⬜⬜ ◣⬜⬜⬜⬜⬜',
                        '⬜⬜ ◤⬜⬜⬜ ▼ ◤⬜⬜ ◥',
                        '⬜ ▌⬜⬜⬜⬜⬜⬜⬜⬜⬜',
                        '⬜⬜ ▄⬜⬜⬜ ◥⬜ ◥⬜⬜',
                        '⬜⬜ ▀⬜⬜⬜ ◢⬜ ◀⬜ ◢',
                        '⬜⬜⬜ ▄⬜⬜⬜⬜⬜⬜⬜',
                        ' ▌⬜⬜⬜ ◣⬜ ╲ ╱ ╱ ◥⬜',
                        '⬜⬜ ◢⬜⬜⬜⬜ ◣ ╱ ◢⬜',
                        '⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜'
                    ].join('\\n' + WHITE);
                case 'complex' /* 13 */:
                    return [
                        '\\n',
                        '⬜⬜⬜ ◤⬜⬜ ─⬜ ◥   ⬜⬜⬜⬜',
                        '⬜⬜⬜ ◤⬜⬜⬜⬜⬜⬜⬜⬜⬜',
                        '⬜⬜⬜⬜ ▲⬜⬜ ▐ ◣⬜ ◥⬜⬜',
                        ' ◤⬜ ◥⬜⬜⬜ ▲⬜ ◤⬜ ◢⬜⬜',
                        '⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜',
                        '⬜⬜ │⬜⬜⬜⬜⬜ ▶⬜⬜ ◥⬜',
                        ' ◤⬜⬜⬜⬜⬜⬜⬜ ◣⬜⬜⬜ ◥',
                        '⬜ ◀⬜⬜⬜⬜ ╲ ◥⬜⬜⬜ ▼⬜',
                        ' ▲⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜ ▀⬜',
                        '⬜⬜ ◥⬜⬜⬜ ─⬜⬜ ◣⬜⬜⬜',
                        ' ◣⬜⬜⬜⬜ ◥⬜⬜⬜⬜⬜⬜⬜',
                        ' ▐⬜⬜⬜ ▄⬜⬜ ▼⬜ ◣⬜ ◢⬜',
                        '⬜⬜⬜⬜⬜ ◣⬜⬜⬜ ◥ ◤⬜ ◢',
                        '⬜⬜⬜⬜⬜⬜⬜⬜⬜ ◣ ◢⬜⬜'
                    ].join('\\n' + WHITE);
                default:
                    break;
            }
        </line>
    </tileentity>
</oo>